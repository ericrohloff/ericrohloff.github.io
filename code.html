<!DOCTYPE html>
<html>
<head>
    <title>Arduino Serial Communication</title>
</head>
<body>
    <h1>Arduino Serial Communication</h1>
    <button id="connectButton">Connect to Arduino</button>
    <input type="text" id="inputField" placeholder="Enter command">
    <button id="sendButton">Send</button>
    <pre id="output"></pre>

    <script>
        let port;
        let reader;
        let writer;
        let inputDone;
        let outputDone;

        document.getElementById('connectButton').addEventListener('click', async () => {
            port = await navigator.serial.requestPort();
            await port.open({ baudRate: 9600 });

            reader = port.readable.getReader();
            writer = port.writable.getWriter();

            readLoop();
        });

        document.getElementById('sendButton').addEventListener('click', async () => {
            const inputField = document.getElementById('inputField');
            const text = inputField.value;
            const data = new TextEncoder().encode(text + '\n');
            await writer.write(data);
        });

        async function readLoop() {
            while (true) {
                const { value, done } = await reader.read();
                if (done) {
                    reader.releaseLock();
                    break;
                }
                document.getElementById('output').textContent += new TextDecoder().decode(value);
            }
        }
    </script>
</body>
</html>

